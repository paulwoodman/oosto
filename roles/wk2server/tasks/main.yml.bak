---
- name: copy rpm package to client
  copy:
     src: redhat-release-server-7.9-6.el7_9.x86_64.rpm
     dest: /tmp
     mode: 0755

- name: Install server package
  yum:
     name: /tmp/redhat-release-server-7.9.6.el7_9.x86_64.rpm 
     state: present

- name: install the server rpm
  command: rpm -ivh --force /tmp/redhat-release-server-7.9-6.el7_9.x86_64.rpm
  ignore_errors: True


- name: remove workstation packages
  yum:
    name: redhat-release-workstation*  
    state: absent

#- name: Remove the workstation RPM
# command: rpm -evh redhat-release-workstation
#ignore_errors: True

#- name: Remove workstation repo
#  ansible.builtin.yum_repository:
#    name: rhel-7-workstation-rpms*
#    state: absent
#  notify: yum-clean-metadata


- name: clear the pem file
  file:
    path: /etc/pki/product/71.pem
    state: absent 

- name: clean yum
  command: yum clean all


- name: remove workstation repos
  command: subscription-manager repos --disable=rhel-7-workstation-rpms
  ignore_errors: True

#- name: copy rpm package to client
#  copy:
#     src: redhat.repo
#     dest: /etc/yum.repos.d/redhat.repo
#     mode: 0755

- name: run distro-sync
  command: yum -y distro-sync

- name: Update all packages
  yum:
    name: '*'
    state: latest
